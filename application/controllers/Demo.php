<?php
/**
 * Created by PhpStorm.
 * User: didi
 * Date: 2018/11/26
 * Time: 下午5:41
 */

class Demo extends MY_Controller{

    public function __construct()
    {
        parent::__construct();
        $this->load->config('nconf');
        $this->load->helper('http');
    }

    /*http://data.sts.didichuxing.com/signal-map/mapJunction/suggest?keyword=%E6%96%87%E5%8C%96&type=didi&city_id=12&token=0faa6ca90df19d26635391c511d124a1&user_id=roadNet*/
    public function mapJunctionSuggest(){
        $params = $this->input->get();
        $params['token']="0faa6ca90df19d26635391c511d124a1";
        $params['user_id']="roadNet";
        $Url = 'http://100.69.238.11:8000/its/signal-map/mapJunction/suggest';
        $ret = httpGET($Url,$params);
        $finalRet = json_decode($ret,true);
        $this->response($finalRet['data']);

    }

    public function test2(){
        $Url = 'http://100.90.164.31:8001/signal-map/mapJunction/polygon';
        $data = [];
        $data["city_id"] = "23";
        $data["version"] = "2019092418";
        $data["polygon"] = "120.661964043975,31.3560923594236;120.651395134628,31.3471499320048;120.648734383285,31.3447492585711;120.648316964507,31.342934968536;120.649990662932,31.3359707020887;120.644926652312,31.3355308363755;120.643682107329,31.3364838761555;120.641064271331,31.3365205313389;120.639175996184,31.3363006000244;120.639948472381,31.3337346967079;120.64058046788,31.3319385227595;120.641438774765,31.3308754648872;120.642576031387,31.3297940661116;120.643412880599,31.3291892105309;120.644018556923,31.3287309840186;120.644426252693,31.3283185782502;120.645112898201,31.3274845966194;120.645574238151,31.3267330903596;120.646089222282,31.3253400384982;120.646545700729,31.3235253742368;120.647275261581,31.3208674695105;120.648106243461,31.3181086683555;120.648696329445,31.3159822282546;120.649415161461,31.3135257635416;120.649930145591,31.3117567026281;120.65083136782,31.3086401414384;120.651496555656,31.306091817727;120.651829149574,31.3049642999881;120.652515795082,31.3025167150453;120.65320244059,31.3000415644931;120.653921272606,31.2975021758074;120.65461864695,31.2949718865349;120.654758121818,31.2944768219927;120.655004885048,31.2930832930241;120.655101444572,31.2921481501913;120.65513363108,31.291249670888;120.655069258064,31.2902044903112;120.654876139015,31.288847571924;120.654077343643,31.2852626462845;120.653583817184,31.2826953523525;120.652998592705,31.2801279885241;120.653341915458,31.2775147071365;120.655085854232,31.2768269894735;120.655965618789,31.275249804697;120.656437687576,31.2742411261884;120.663411431015,31.2754882180412;120.663690380752,31.2746812781367;120.664182901382,31.2725905380907;120.664596464485,31.2707656876353;120.664875414222,31.2690691869584;120.665240194649,31.2660062382137;120.665465500206,31.264117064565;120.665836147964,31.2628147966311;120.666887573898,31.2612190353657;120.668089203537,31.2596049045682;120.669612698257,31.2593664510874;120.672015957534,31.259476506615;120.672294907272,31.2611456663829;120.672895722091,31.2628331385577;120.673077106476,31.2643463352281;120.672883987427,31.2658778489694;120.672605037689,31.2669783225378;120.67241191864,31.2680237605398;120.672551393509,31.2688399277705;120.673286821693,31.2699862181395;120.672272443771,31.2715910012586;120.671585798264,31.273525874892;120.670952796936,31.2748188251994;120.670877695084,31.2754607088399;120.671156644821,31.2767077845686;120.671532154083,31.2775055376007;120.672578718513,31.2785600283807;120.673904232681,31.2794677979568;120.67439775914,31.2803847280522;120.674977116287,31.2817784447232;120.675470642745,31.2832638306055;120.675663761795,31.284895894288;120.675577931106,31.2862528695495;120.675685219467,31.2874998025714;120.676178745925,31.2883433067349;120.676865391433,31.289315160871;120.677616409957,31.2900302924217;120.68068485707,31.2889667614836;120.682134255767,31.286399568408;120.682629793882,31.282438619115;120.68331643939,31.278990990784;120.686492174864,31.2741494276073;120.688723772764,31.2715084702212;120.695590227842,31.2690875276694;120.699795931578,31.2647590210181;120.702971667051,31.2581558318153;120.708464831114,31.254560567909;120.708808153868,31.2509651670755;120.71153126657,31.2493875500217;120.71547947824,31.2487638336833;120.719599351287,31.2452415935091;120.722431764007,31.2424530602008;120.725564584136,31.2401414504412;120.730866640806,31.2362152534366;120.735844820738,31.2323989803427;120.740799531341,31.2352611996148;120.743031129241,31.2376096224603;120.746078118682,31.2392241293019;120.749425515532,31.2399212941802;120.75324498117,31.2412789162817;120.754489526153,31.2394075942424;120.756935700774,31.2391140501665;120.759768113494,31.2395543659383;120.763158425689,31.2406551463879;120.766377076507,31.2395176730357;120.769080743194,31.2419393740322;120.770840272307,31.2446545407075;120.773352831602,31.2499378845458;120.773438662291,31.2557345466896;120.77403947711,31.2611640086339;120.775498598814,31.2651992172047;120.783199891448,31.2682071695212;120.784420967102,31.2669232991642;120.784678459167,31.264245456205;120.784850120544,31.2627047449963;120.792145729065,31.2635484709168;120.791931152344,31.2674368494033;120.795192718506,31.2676569415073;120.799550637603,31.2672901210488;120.80448590219,31.2676202595256;120.805558785796,31.2713250676573;120.804271325469,31.2740393891924;120.798563584685,31.2793577657463;120.802340134978,31.2838323054313;120.806502923369,31.2909837927174;120.80961227417,31.2930741250021;120.818070620298,31.2914605392487;120.825366228819,31.2896268855472;120.833949297667,31.2869863615596;120.838669985533,31.2836856025785;120.846823900938,31.2830254369166;120.850600451231,31.2888200666196;120.85291787982,31.2963012136439;120.855492800474,31.3027550594445;120.858153551817,31.3062018187352;120.863475054502,31.3096484519304;120.862359255552,31.3147081743303;120.8602758497,31.3205008560738;120.858773812652,31.3250467617954;120.856370553374,31.3301056568635;120.854739770293,31.3331481946982;120.853752717376,31.3375468706769;120.852765664458,31.3419086879717;120.849761590362,31.352207638859;120.848087891936,31.3578514253787;120.846671685576,31.3645209181529;120.845985040069,31.3684784154297;120.84448300302,31.3744876296771;120.819654464722,31.3688814845056;120.821589678526,31.3792873966825;120.823610723019,31.3907179152768;120.825670659542,31.4009748884433;120.826700627804,31.4115237487642;120.827043950558,31.4244151897475;120.826528966427,31.440526999115;120.809971690178,31.4374513221022;120.773579478264,31.4286631173586;120.752027928829,31.4167977342217;120.736999511719,31.4069820237146;120.730819702148,31.3999492415561;120.727386474609,31.3913040582167;120.722236633301,31.3828046274934;120.713310241699,31.3861751834375;120.698547363281,31.3744509892913;120.681209564209,31.3659500336137;120.661964043975,31.3560923594236";
        $ret = httpPOST($Url,$data);
        // print_r($ret);exit;
        $jsonData="";
        $arr = json_decode($ret,true);
        // print_r($arr["data"]["dataList"]);
        // array_column(input, column_key);
        $junctions = array_keys($arr["data"]["filter_juncs"]);
        foreach ($junctions as $junctionid) {
            echo "INSERT INTO `area_junction_relation` (`id`, `area_id`, `junction_id`, `user_id`, `update_at`, `create_at`, `delete_at`) VALUES (NULL, '131', '".$junctionid."', '0', '2019-09-26 10:28:40', '2019-09-26 10:28:40', '1970-01-01 00:00:00');<br/>";
        }
        exit;

    }

    public function test(){

        $arr = json_decode($jsonData,true);
        // print_r($arr["data"]["dataList"]);
        // array_column(input, column_key);
        $junctions = array_column($arr["data"]["dataList"], "logic_junction_id");
        foreach ($junctions as $junctionid) {
            echo "INSERT INTO `area_junction_relation` (`id`, `area_id`, `junction_id`, `user_id`, `update_at`, `create_at`, `delete_at`) VALUES (NULL, '127', '".$junctionid."', '0', '2018-08-30 21:29:40', '2018-08-30 21:29:40', '1970-01-01 00:00:00');<br/>";
        }
        exit;
        // print_r($junctions);exit;
    }

    public function getShortUrl(){
        $params = $this->input->post();

        $url = "http://100.69.238.11:8000/daijia/shortserver/admin/add";
        $data = array();
        $data['appkey'] = "oveS7s8f3DymeHjnrUy0lfqBW1x1n3KD";
        $data['url']  = $params['url'];
        $ret  = httpPOST($url,$data);
        $finalRet = json_decode($ret,true);
        $this->response($finalRet['short_url']);
    }
}